name: Telegram RSS (Node)

on:
  push:
    branches: [ "main" ]   # push-ra is fut
  schedule:
    - cron: "*/3 * * * *"   # 3 percenként (UTC)
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      # Ha van lockfile, ci-t használunk, különben install
      - name: Install deps (ci)
        if: ${{ hashFiles('package-lock.json') != '' }}
        run: npm ci --omit=dev --no-audit --no-fund

      - name: Install deps (no lockfile)
        if: ${{ hashFiles('package-lock.json') == '' }}
        run: npm install --omit=dev --no-audit --no-fund

      - name: Run RSS script
        run: npm run rss:run
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
          GIST_TOKEN: ${{ secrets.GIST_TOKEN }}
          GIST_ID: ${{ secrets.GIST_ID }}   # első futásnál lehet üres
          MAX_ITEMS_PER_FEED: "10"
          SEND_DELAY_MS: "500"
          DEBUG: "0"                        # ideiglenesen állíthatod "1"-re

          # --- Google News beállítások ---
          GNEWS_FROM_KEYWORDS: "1"          # kulcsszavakból automatikus GNews feedek
          GNEWS_HL: "hu"
          GNEWS_GL: "HU"
          GNEWS_CEID: "HU:hu"
          GNEWS_WHEN: "3d"                  # opcionális: csak az elmúlt 3 nap
          GNEWS_EXTRA: "-sport -sports -football -soccer -recept -recipe -cooking -food -gasztronomia -konyha -kultura -kultúra -culture -film -mozi -music -zene -koncert -festival -szinhaz -theatre -art -entertainment -celebrity -celeb" # opcionális: extra kizárások/szűkítés
